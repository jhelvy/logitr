<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basic Usage • logitr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Basic Usage">
<meta property="og:description" content="logitr">
<meta property="og:image" content="https://jhelvy.github.io/logitr/reference/figures/logo.png">
<meta property="og:image:alt" content="Logo for the logitr package">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@JohnHelveston">
<meta name="twitter:site" content="@JohnHelveston">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">logitr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/basic_usage.html">Basic Usage</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/utility_models.html">Utility Models in the Preference &amp; WTP Space</a>
    </li>
    <li>
      <a href="../articles/data_formatting.html">Data Formatting and Encoding</a>
    </li>
    <li>
      <a href="../articles/mnl_models.html">Estimating Multinomial Logit Models</a>
    </li>
    <li>
      <a href="../articles/mxl_models.html">Estimating Mixed Logit Models</a>
    </li>
    <li>
      <a href="../articles/interactions.html">Estimating Models with Interactions</a>
    </li>
    <li>
      <a href="../articles/mnl_models_weighted.html">Estimating Weighted Logit Models</a>
    </li>
    <li>
      <a href="../articles/predict.html">Predicting Probabilities and Outcomes with Estimated Models</a>
    </li>
    <li>
      <a href="../articles/summarizing_results.html">Summarizing Results</a>
    </li>
    <li>
      <a href="../articles/benchmark.html">Benchmarking estimation speed against other packages</a>
    </li>
    <li>
      <a href="../articles/convergence.html">WTP space convergence issues in other packages</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jhelvy/logitr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="basic_usage_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Basic Usage</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jhelvy/logitr/blob/HEAD/vignettes/basic_usage.Rmd" class="external-link"><code>vignettes/basic_usage.Rmd</code></a></small>
      <div class="hidden name"><code>basic_usage.Rmd</code></div>

    </div>

    
    

<div class="section level2">
<h2 id="data-format">Data format<a class="anchor" aria-label="anchor" href="#data-format"></a>
</h2>
<p>The {logitr} package requires that data be structured in a <code>data.frame</code> and arranged in a “long” format <span class="citation">[@Wickham2014]</span> where each row contains data on a single alternative from a choice observation. The choice observations do not have to be symmetric, meaning they can have a “ragged” structure where different choice observations have different numbers of alternatives. The data must also include variables for each of the following:</p>
<ul>
<li>
<strong>Outcome</strong>: A dummy-coded variable that identifies which alternative was chosen (<code>1</code> is chosen, <code>0</code> is not chosen). Only one alternative should have a <code>1</code> per choice observation.</li>
<li>
<strong>Observation ID</strong>: A sequence of repeated numbers that identifies each unique choice observation. For example, if the first three choice observations had 2 alternatives each, then the first 6 rows of the <code>obsID</code> variable would be <code>1, 1, 2, 2, 3, 3</code>.</li>
<li>
<strong>Covariates</strong>: Other variables that will be used as model covariates.</li>
</ul>
<p>The <a href="data_formatting.html">“Data Formatting and Encoding”</a> vignette has more details about the required data format.</p>
</div>
<div class="section level2">
<h2 id="model-specification-interface">Model specification interface<a class="anchor" aria-label="anchor" href="#model-specification-interface"></a>
</h2>
<p>Models are specified and estimated using the <code><a href="../reference/logitr.html">logitr()</a></code> function. The <code>data</code> argument should be set to the data frame containing the data, and the <code>outcome</code> and <code>obsID</code> arguments should be set to the column names in the data frame that correspond to the dummy-coded outcome (choice) variable and the observation ID variable, respectively. All variables to be used as model covariates should be provided as a vector of column names to the <code>pars</code> argument. Each variable in the vector is additively included as a covariate in the utility model, with the interpretation that they represent utilities in preference space models and WTPs in a WTP space model.</p>
<p>For example, consider a preference space model where the utility for yogurt is given by the following utility model:</p>
<p><span class="math display">\[\begin{equation}
    u_{j} =
        \alpha p_{j} +
        \beta_1 x_{j1} +
        \beta_2 x_{j2} +
        \beta_3 x_{j3} +
        \beta_4 x_{j4} +
        \varepsilon_{j},
\label{eq:yogurtUtilityPref}
\end{equation}\]</span></p>
<p> where <span class="math inline">\(p_{j}\)</span> is <code>price</code>, <span class="math inline">\(x_{j1}\)</span> is <code>feat</code>, and <span class="math inline">\(x_{j2-4}\)</span> are dummy-coded variables for each <code>brand</code> (with the fourth brand representing the reference level). This model can be estimated using the <code><a href="../reference/logitr.html">logitr()</a></code> function as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/jhelvy/logitr" class="external-link">"logitr"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mnl_pref</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/logitr.html">logitr</a></span><span class="op">(</span></span>
<span>    data    <span class="op">=</span> <span class="va">yogurt</span>,</span>
<span>    outcome <span class="op">=</span> <span class="st">"choice"</span>,</span>
<span>    obsID   <span class="op">=</span> <span class="st">"obsID"</span>,</span>
<span>    pars    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"price"</span>, <span class="st">"feat"</span>, <span class="st">"brand"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The equivalent model in the WTP space is given by the following utility model:</p>
<p><span class="math display">\[\begin{equation}
    u_{j} =
        \lambda \left(
            \omega_1 x_{j1} +
            \omega_1 x_{j2} +
            \omega_1 x_{j3} +
            \omega_2 x_{j4} -
            p_{j}
        \right) +
        \varepsilon_{j},
\label{eq:yogurtUtilityWtp}
\end{equation}\]</span></p>
<p> To specify this model, simply move <code>"price"</code> from the <code>pars</code> argument to the <code>scalePar</code> argument:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mnl_wtp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/logitr.html">logitr</a></span><span class="op">(</span></span>
<span>    data     <span class="op">=</span> <span class="va">yogurt</span>,</span>
<span>    outcome  <span class="op">=</span> <span class="st">"choice"</span>,</span>
<span>    obsID    <span class="op">=</span> <span class="st">"obsID"</span>,</span>
<span>    pars     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"feat"</span>, <span class="st">"brand"</span><span class="op">)</span>,</span>
<span>    scalePar <span class="op">=</span> <span class="st">"price"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p> In the above model, the variables in <code>pars</code> are marginal WTPs, whereas in the preference space model they are marginal utilities. Price is separately specified with the <code>scalePar</code> argument because it acts as a scaling term in WTP space models. While price is the most typical scaling variable, other continuous variables can also be used, such as time.</p>
<p>Interactions between covariates can be entered in the <code>pars</code> vector separated by the <code>*</code> symbol. For example, an interaction between <code>price</code> with <code>feat</code> in a preference space model could be included by specifying <code>pars = c("price", "feat", "brand", "price*feat")</code>, or even more concisely just <code>pars = c("price*feat", "brand")</code> as the interaction between <code>price</code> and <code>feat</code> will produce individual parameters for <code>price</code> and <code>feat</code> in addition to the interaction parameter.</p>
<p>Both of these examples are multinomial logit models with fixed parameters. See the <a href="mnl_models.html">“Estimating Multinomial Logit Models”</a> vignette for more details.</p>
</div>
<div class="section level2">
<h2 id="parallelized-multi-start-estimation">Parallelized multi-start estimation<a class="anchor" aria-label="anchor" href="#parallelized-multi-start-estimation"></a>
</h2>
<p>Since WTP space models are non-linear and have non-convex log-likelihood functions, it is recommended to use a multi-start search to run the optimization loop multiple times to search for different local minima. This is implemented using the <code>numMultiStarts</code> argument, e.g.:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mnl_wtp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/logitr.html">logitr</a></span><span class="op">(</span></span>
<span>    data     <span class="op">=</span> <span class="va">yogurt</span>,</span>
<span>    outcome  <span class="op">=</span> <span class="st">"choice"</span>,</span>
<span>    obsID    <span class="op">=</span> <span class="st">"obsID"</span>,</span>
<span>    pars     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"feat"</span>, <span class="st">"brand"</span><span class="op">)</span>,</span>
<span>    scalePar <span class="op">=</span> <span class="st">"price"</span>,</span>
<span>    numMultiStarts <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The multi-start is parallelized by default for faster estimation, and the number of cores to use can be manually set using the <code>numCores</code> argument. If <code>numCores</code> is not provide, then the number of cores is set to <code>parallel::detectCores() - 1</code>. For models with larger data sets, you may need to set <code>numCores = 1</code> to avoid memory overflow issues.</p>
</div>
<div class="section level2">
<h2 id="mixed-logit-models">Mixed logit models<a class="anchor" aria-label="anchor" href="#mixed-logit-models"></a>
</h2>
<blockquote>
<p>See the <a href="mxl_models.html">“Estimating Mixed Logit Models”</a> vignette for more details.</p>
</blockquote>
<p>To estimate a mixed logit model, use the <code>randPars</code> argument in the <code><a href="../reference/logitr.html">logitr()</a></code> function to denote which parameters will be modeled with a distribution. The current package version supports normal (<code>"n"</code>), log-normal (<code>"ln"</code>), and zero-censored normal (<code>"cn"</code>) distributions.</p>
<p>For example, assume the observed utility for yogurts was <span class="math inline">\(v_{j} = \alpha p_{j} + \beta_1 x_{j1} + \beta_2 x_{j2} + \beta_3 x_{j3} + \beta_4 x_{j4}\)</span>, where <span class="math inline">\(p_{j}\)</span> is <code>price</code>, <span class="math inline">\(x_{j1}\)</span> is <code>feat</code>, and <span class="math inline">\(x_{j2-4}\)</span> are dummy-coded variables for <code>brand</code>. To model <code>feat</code> as well as each of the brands as normally-distributed, set <code>randPars = c(feat = "n", brand = "n")</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mxl_pref</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/logitr.html">logitr</a></span><span class="op">(</span></span>
<span>    data     <span class="op">=</span> <span class="va">yogurt</span>,</span>
<span>    outcome  <span class="op">=</span> <span class="st">'choice'</span>,</span>
<span>    obsID    <span class="op">=</span> <span class="st">'obsID'</span>,</span>
<span>    pars     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'price'</span>, <span class="st">'feat'</span>, <span class="st">'brand'</span><span class="op">)</span>,</span>
<span>    randPars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>feat <span class="op">=</span> <span class="st">'n'</span>, brand <span class="op">=</span> <span class="st">'n'</span><span class="op">)</span>,</span>
<span>    numMultiStarts <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Since mixed logit models also have non-convex log-likelihood functions, it is recommended to use a multi-start search to run the optimization loop multiple times to search for different local minima.</p>
</div>
<div class="section level2">
<h2 id="viewing-results">Viewing results<a class="anchor" aria-label="anchor" href="#viewing-results"></a>
</h2>
<blockquote>
<p>See the <a href="summarizing_results.html">“Summarizing Results”</a> vignette for more details.</p>
</blockquote>
<p>Use the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function to print a summary of the results from an estimated model, e.g.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mnl_pref</span><span class="op">)</span></span>
<span><span class="co">#&gt; =================================================</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model estimated on: Tue Feb 07 13:59:27 2023 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Using logitr version: 1.0.0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; logitr(data = yogurt, outcome = "choice", obsID = "obsID", pars = c("price", </span></span>
<span><span class="co">#&gt;     "feat", "brand"))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Frequencies of alternatives:</span></span>
<span><span class="co">#&gt;        1        2        3        4 </span></span>
<span><span class="co">#&gt; 0.402156 0.029436 0.229270 0.339138 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Exit Status: 3, Optimization stopped because ftol_rel or ftol_abs was reached.</span></span>
<span><span class="co">#&gt;                                 </span></span>
<span><span class="co">#&gt; Model Type:    Multinomial Logit</span></span>
<span><span class="co">#&gt; Model Space:          Preference</span></span>
<span><span class="co">#&gt; Model Run:                1 of 1</span></span>
<span><span class="co">#&gt; Iterations:                   21</span></span>
<span><span class="co">#&gt; Elapsed Time:        0h:0m:0.04s</span></span>
<span><span class="co">#&gt; Algorithm:        NLOPT_LD_LBFGS</span></span>
<span><span class="co">#&gt; Weights Used?:             FALSE</span></span>
<span><span class="co">#&gt; Robust?                    FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Coefficients: </span></span>
<span><span class="co">#&gt;               Estimate Std. Error  z-value  Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; price        -0.366555   0.024365 -15.0441 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; feat          0.491439   0.120062   4.0932 4.254e-05 ***</span></span>
<span><span class="co">#&gt; brandhiland  -3.715477   0.145417 -25.5506 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; brandweight  -0.641138   0.054498 -11.7645 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; brandyoplait  0.734519   0.080642   9.1084 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt;                                      </span></span>
<span><span class="co">#&gt; Log-Likelihood:         -2656.8878790</span></span>
<span><span class="co">#&gt; Null Log-Likelihood:    -3343.7419990</span></span>
<span><span class="co">#&gt; AIC:                     5323.7757580</span></span>
<span><span class="co">#&gt; BIC:                     5352.7168000</span></span>
<span><span class="co">#&gt; McFadden R2:                0.2054148</span></span>
<span><span class="co">#&gt; Adj McFadden R2:            0.2039195</span></span>
<span><span class="co">#&gt; Number of Observations:  2412.0000000</span></span></code></pre></div>
<p>Use <code><a href="../reference/statusCodes.html">statusCodes()</a></code> to print a description of each status code from the <code>nloptr</code> optimization routine.</p>
<p>You can also extract other values of interest at the solution, such as:</p>
<p><strong>The estimated coefficients</strong></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mnl_pref</span><span class="op">)</span></span>
<span><span class="co">#&gt;        price         feat  brandhiland  brandweight brandyoplait </span></span>
<span><span class="co">#&gt;   -0.3665546    0.4914392   -3.7154773   -0.6411384    0.7345195</span></span></code></pre></div>
<p><strong>The coefficient standard errors</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/se.html">se</a></span><span class="op">(</span><span class="va">mnl_pref</span><span class="op">)</span></span>
<span><span class="co">#&gt;        price         feat  brandhiland  brandweight brandyoplait </span></span>
<span><span class="co">#&gt;   0.02436526   0.12006175   0.14541671   0.05449794   0.08064229</span></span></code></pre></div>
<p><strong>The log-likelihood</strong></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">mnl_pref</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'log Lik.' -2656.888 (df=5)</span></span></code></pre></div>
<p><strong>The variance-covariance matrix</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">mnl_pref</span><span class="op">)</span></span>
<span><span class="co">#&gt;                      price          feat  brandhiland  brandweight</span></span>
<span><span class="co">#&gt; price         0.0005936657  5.729619e-04  0.001851795 1.249988e-04</span></span>
<span><span class="co">#&gt; feat          0.0005729619  1.441482e-02  0.000855011 5.092011e-06</span></span>
<span><span class="co">#&gt; brandhiland   0.0018517954  8.550110e-04  0.021146019 1.490080e-03</span></span>
<span><span class="co">#&gt; brandweight   0.0001249988  5.092011e-06  0.001490080 2.970026e-03</span></span>
<span><span class="co">#&gt; brandyoplait -0.0015377721 -1.821331e-03 -0.003681036 7.779428e-04</span></span>
<span><span class="co">#&gt;               brandyoplait</span></span>
<span><span class="co">#&gt; price        -0.0015377721</span></span>
<span><span class="co">#&gt; feat         -0.0018213311</span></span>
<span><span class="co">#&gt; brandhiland  -0.0036810363</span></span>
<span><span class="co">#&gt; brandweight   0.0007779427</span></span>
<span><span class="co">#&gt; brandyoplait  0.0065031782</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="computing-and-comparing-wtp">Computing and comparing WTP<a class="anchor" aria-label="anchor" href="#computing-and-comparing-wtp"></a>
</h2>
<p>For models in the preference space, a summary table of the computed WTP based on the estimated preference space parameters can be obtained with the <code><a href="../reference/wtp.html">wtp()</a></code> function. For example, the computed WTP from the previously estimated fixed parameter model can be obtained with the following command:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/wtp.html">wtp</a></span><span class="op">(</span><span class="va">mnl_pref</span>, scalePar <span class="op">=</span> <span class="st">"price"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                Estimate Std. Error  z-value  Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; scalePar       0.366555   0.024352  15.0525 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; feat           1.340699   0.358679   3.7379 0.0001856 ***</span></span>
<span><span class="co">#&gt; brandhiland  -10.136219   0.583054 -17.3847 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; brandweight   -1.749094   0.181839  -9.6189 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; brandyoplait   2.003848   0.143695  13.9451 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>The <code><a href="../reference/wtp.html">wtp()</a></code> function divides the non-price parameters by the negative of the <code>scalePar</code> parameter (usually “price”). Standard errors are estimated using the Krinsky and Robb parametric bootstrapping method <span class="citation">[@Krinsky1986]</span>. Similarly, the <code><a href="../reference/wtpCompare.html">wtpCompare()</a></code> function can be used to compare the WTP from a WTP space model with that computed from an equivalent preference space model:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/wtpCompare.html">wtpCompare</a></span><span class="op">(</span><span class="va">mnl_pref</span>, <span class="va">mnl_wtp</span>, scalePar <span class="op">=</span> <span class="st">"price"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                       pref           wtp  difference</span></span>
<span><span class="co">#&gt; scalePar         0.3665546     0.3665832  0.00002867</span></span>
<span><span class="co">#&gt; feat             1.3406987     1.3405926 -0.00010605</span></span>
<span><span class="co">#&gt; brandhiland    -10.1362190   -10.1357635  0.00045548</span></span>
<span><span class="co">#&gt; brandweight     -1.7490940    -1.7490826  0.00001133</span></span>
<span><span class="co">#&gt; brandyoplait     2.0038476     2.0038208 -0.00002686</span></span>
<span><span class="co">#&gt; logLik       -2656.8878790 -2656.8878779  0.00000106</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="predicting-probabilities-and-outcomes">Predicting probabilities and outcomes<a class="anchor" aria-label="anchor" href="#predicting-probabilities-and-outcomes"></a>
</h2>
<p>Estimated models can be used to predict probabilities and outcomes for a set (or multiple sets) of alternatives based on an estimated model. As an example, consider predicting probabilities for two of the choice observations from the <code>yogurt</code> dataset:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span></span>
<span>  <span class="va">yogurt</span>, <span class="va">obsID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">42</span>, <span class="fl">13</span><span class="op">)</span>,</span>
<span>  select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'obsID'</span>, <span class="st">'alt'</span>, <span class="st">'choice'</span>, <span class="st">'price'</span>, <span class="st">'feat'</span>, <span class="st">'brand'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span></span>
<span><span class="co">#&gt;     obsID alt choice price feat   brand</span></span>
<span><span class="co">#&gt; 49     13   1      0   8.1    0  dannon</span></span>
<span><span class="co">#&gt; 50     13   2      0   5.0    0  hiland</span></span>
<span><span class="co">#&gt; 51     13   3      1   8.6    0  weight</span></span>
<span><span class="co">#&gt; 52     13   4      0  10.8    0 yoplait</span></span>
<span><span class="co">#&gt; 165    42   1      1   6.3    0  dannon</span></span>
<span><span class="co">#&gt; 166    42   2      0   6.1    1  hiland</span></span>
<span><span class="co">#&gt; 167    42   3      0   7.9    0  weight</span></span>
<span><span class="co">#&gt; 168    42   4      0  11.5    0 yoplait</span></span></code></pre></div>
<p>In the example below, the probabilities for these two sets of alternatives are computed using the fixed parameter <code>mnl_pref</code> model using the <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> method:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">mnl_pref</span>,</span>
<span>  newdata <span class="op">=</span> <span class="va">data</span>,</span>
<span>  obsID   <span class="op">=</span> <span class="st">"obsID"</span>,</span>
<span>  ci      <span class="op">=</span> <span class="fl">0.95</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">probs</span></span>
<span><span class="co">#&gt;     obsID predicted_prob predicted_prob_lower predicted_prob_upper</span></span>
<span><span class="co">#&gt; 49     13     0.43685145           0.41617120           0.45779682</span></span>
<span><span class="co">#&gt; 50     13     0.03312986           0.02601248           0.04096272</span></span>
<span><span class="co">#&gt; 51     13     0.19155548           0.17655994           0.20742832</span></span>
<span><span class="co">#&gt; 52     13     0.33846321           0.31920095           0.35904791</span></span>
<span><span class="co">#&gt; 165    42     0.60764778           0.57292315           0.63968190</span></span>
<span><span class="co">#&gt; 166    42     0.02602007           0.01825573           0.03756514</span></span>
<span><span class="co">#&gt; 167    42     0.17803313           0.16224493           0.19420043</span></span>
<span><span class="co">#&gt; 168    42     0.18829902           0.16925319           0.20975704</span></span></code></pre></div>
<p>The resulting <code>probs</code> data frame contains the expected probabilities for each alternative. The lower and upper predictions reflect a 95% confidence interval (controlled by the <code>ci</code> argument), which are estimated using the Krinsky and Robb parametric bootstrapping method <span class="citation">[@Krinsky1986]</span>. The default is <code>ci = NULL</code>, in which case no CI predictions are made.</p>
<p>WTP space models can also be used to predict probabilities:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">mnl_wtp</span>,</span>
<span>  newdata <span class="op">=</span> <span class="va">data</span>,</span>
<span>  obsID   <span class="op">=</span> <span class="st">"obsID"</span>,</span>
<span>  ci      <span class="op">=</span> <span class="fl">0.95</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">probs</span></span>
<span><span class="co">#&gt;     obsID predicted_prob predicted_prob_lower predicted_prob_upper</span></span>
<span><span class="co">#&gt; 49     13     0.43686141           0.41422977           0.45843108</span></span>
<span><span class="co">#&gt; 50     13     0.03312947           0.02638835           0.04192633</span></span>
<span><span class="co">#&gt; 51     13     0.19154829           0.17621110           0.20847126</span></span>
<span><span class="co">#&gt; 52     13     0.33846083           0.31771361           0.35783665</span></span>
<span><span class="co">#&gt; 165    42     0.60767120           0.57285614           0.63927970</span></span>
<span><span class="co">#&gt; 166    42     0.02601800           0.01826199           0.03705478</span></span>
<span><span class="co">#&gt; 167    42     0.17802363           0.16163695           0.19461865</span></span>
<span><span class="co">#&gt; 168    42     0.18828717           0.16875517           0.20893922</span></span></code></pre></div>
<p>You can also use the <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> method to predict outcomes by setting <code>type = "outcome"</code> (the default value is <code>"prob"</code> for predicting probabilities). If no new data are provided for <code>newdata</code>, then outcomes will be predicted for every alternative in the original data used to estimate the model. In the example below the <code>returnData</code> argument is also set to <code>TRUE</code> so that the predicted outcomes can be compared to the actual ones.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outcomes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">mnl_pref</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"outcome"</span>,</span>
<span>  returnData <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">outcomes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'obsID'</span>, <span class="st">'choice'</span>, <span class="st">'predicted_outcome'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   obsID choice predicted_outcome</span></span>
<span><span class="co">#&gt; 1     1      0                 1</span></span>
<span><span class="co">#&gt; 2     1      0                 0</span></span>
<span><span class="co">#&gt; 3     1      1                 0</span></span>
<span><span class="co">#&gt; 4     1      0                 0</span></span>
<span><span class="co">#&gt; 5     2      1                 0</span></span>
<span><span class="co">#&gt; 6     2      0                 0</span></span></code></pre></div>
<p>You can quickly compute the accuracy by dividing the number of correctly predicted choices by the total number of choices:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chosen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">outcomes</span>, <span class="va">choice</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">chosen</span><span class="op">$</span><span class="va">correct</span> <span class="op">&lt;-</span> <span class="va">chosen</span><span class="op">$</span><span class="va">choice</span> <span class="op">==</span> <span class="va">chosen</span><span class="op">$</span><span class="va">predicted_outcome</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">chosen</span><span class="op">$</span><span class="va">correct</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">chosen</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.3586235</span></span></code></pre></div>
<p>See the <a href="predict.html">“Predicting Probabilities and Choices from Estimated Models”</a> vignette for more details about making predictions.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by John Helveston.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
