<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Formatting and Encoding • logitr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Data Formatting and Encoding">
<meta property="og:description" content="logitr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">logitr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/basic_usage.html">Basic Usage</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/utility_models.html">Utility Models in the Preference &amp; WTP Space</a>
    </li>
    <li>
      <a href="../articles/data_formatting.html">Data Formatting and Encoding</a>
    </li>
    <li>
      <a href="../articles/mnl_models.html">Estimating Multinomial Logit Models</a>
    </li>
    <li>
      <a href="../articles/mxl_models.html">Estimating Mixed Logit Models</a>
    </li>
    <li>
      <a href="../articles/interactions.html">Estimating Models with Interactions</a>
    </li>
    <li>
      <a href="../articles/mnl_models_weighted.html">Estimating Weighted Logit Models</a>
    </li>
    <li>
      <a href="../articles/predict_probs.html">Predicting Choice Probabilities from Estimated Models</a>
    </li>
    <li>
      <a href="../articles/predict_choices.html">Predicting Choices from Estimated Models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jhelvy/logitr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="data_formatting_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Data Formatting and Encoding</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jhelvy/logitr/blob/master/vignettes/data_formatting.Rmd"><code>vignettes/data_formatting.Rmd</code></a></small>
      <div class="hidden name"><code>data_formatting.Rmd</code></div>

    </div>

    
    

<div id="basic-required-format" class="section level1">
<h1 class="hasAnchor">
<a href="#basic-required-format" class="anchor"></a>Basic required format</h1>
<p>The {logitr} package requires that data be structured in a <code>data.frame</code> and arranged in “long” or “tidy” format <span class="citation">[@Wickham2014]</span>. Each row should be an alternative from a choice observation. The choice observations do not have to be symmetric, meaning they can have a “ragged” structure where different choice observations have different numbers of alternatives. The data must also include variables for each of the following:</p>
<ul>
<li>
<strong>Choice</strong>: A dummy variable that identifies which alternative was chosen (<code>1</code> is chosen, <code>0</code> is not chosen). Only one alternative should be chosen per choice observation.</li>
<li>
<strong>Observation ID</strong>: A sequence of repeated numbers that identifies each unique choice observation. For example, if the first three choice observations had 2 alternatives each, then the first 6 rows of the <code>obsID</code> variable would be <code>1, 1, 2, 2, 3, 3</code>.</li>
<li>
<strong>Covariates</strong>: Other variables that will be used as model covariates.</li>
</ul>
<p>The {logitr} package contains several example data sets that illustrate this data structure. For example, the <code>yogurt</code> contains observations of yogurt purchases by a panel of 100 households <span class="citation">[@Jain1994]</span>. Choice is identified by the <code>choice</code> column, the observation ID is identified by the <code>obsID</code> column, and the columns <code>price</code>, <code>feat</code>, and <code>brand</code> can be used as model covariates (brand is also broken out into additional dummy-coded columns):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">yogurt</span><span class="op">)</span>
<span class="co">#&gt;   id obsID alt choice price feat   brand dannon hiland weight yoplait</span>
<span class="co">#&gt; 1  1     1   1      0   8.1    0  dannon      1      0      0       0</span>
<span class="co">#&gt; 2  1     1   2      0   6.1    0  hiland      0      1      0       0</span>
<span class="co">#&gt; 3  1     1   3      1   7.9    0  weight      0      0      1       0</span>
<span class="co">#&gt; 4  1     1   4      0  10.8    0 yoplait      0      0      0       1</span>
<span class="co">#&gt; 5  1     2   1      1   9.8    0  dannon      1      0      0       0</span>
<span class="co">#&gt; 6  1     2   2      0   6.4    0  hiland      0      1      0       0</span></code></pre></div>
<p>This data set also includes an <code>alt</code> variable that determines the alternatives included in the choice set of each observation and an <code>id</code> variable that determines the individual as the data have a panel structure containing multiple choice observations from each individual.</p>
</div>
<div id="continuous-versus-discrete-variables" class="section level1">
<h1 class="hasAnchor">
<a href="#continuous-versus-discrete-variables" class="anchor"></a>Continuous versus discrete variables</h1>
<p>Variables are modeled as either continuous or discrete based on their data <em>type</em>. Numeric variables are by default estimated with a single “slope” coefficient. For example, consider a data frame that contains a <code>price</code> variable with the levels $10, $15, and $20. Adding <code>price</code> to the <code>pars</code> argument in the main <code><a href="../reference/logitr.html">logitr()</a></code> function would result in a single <code>price</code> coefficient for the “slope” of the change in price.</p>
<p>In contrast, categorical variables (i.e. <code>character</code> or <code>factor</code> type variables) are by default estimated with a coefficient for all but the first level, which serves as the reference level. The default reference level is determined alphabetically, but it can also be set by modifying the factor levels for that variable. For example, the default reference level for the <code>brand</code> variable is <code>"dannon"</code> as it is alphabetically first. To set <code>"weight"</code> as the reference level, the factor levels can be modified using the <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> function:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">brands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"weight"</span>, <span class="st">"hiland"</span>, <span class="st">"yoplait"</span>, <span class="st">"dannon"</span><span class="op">)</span>
<span class="va">yogurt</span><span class="op">$</span><span class="va">brand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">yogurt</span><span class="op">$</span><span class="va">brand</span>, levels <span class="op">=</span> <span class="va">brands</span><span class="op">)</span></code></pre></div>
</div>
<div id="creating-dummy-coded-variables" class="section level1">
<h1 class="hasAnchor">
<a href="#creating-dummy-coded-variables" class="anchor"></a>Creating dummy coded variables</h1>
<p>If you wish to make dummy-coded variables yourself to use them in a model, I recommend using the <code>dummy_cols()</code> function from the <a href="https://github.com/jacobkap/fastDummies">{fastDummies}</a> package. For example, in the code below, I create dummy-coded columns for the <code>brand</code> variable and then use those variables as covariates in a model:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yogurt</span> <span class="op">&lt;-</span> <span class="fu">fastDummies</span><span class="fu">::</span><span class="fu"><a href="https://jacobkap.github.io/fastDummies/reference/dummy_cols.html">dummy_cols</a></span><span class="op">(</span><span class="va">yogurt</span>, <span class="st">"brand"</span><span class="op">)</span></code></pre></div>
<p>The <code>yogurt</code> data frame now has new dummy-coded columns for brand (it actually already had these, but now there are additional ones):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">yogurt</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 × 15</span>
<span class="co">#&gt;      id obsID   alt choice price  feat brand   dannon hiland weight yoplait</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1     1     1      0  8.1      0 dannon       1      0      0       0</span>
<span class="co">#&gt; 2     1     1     2      0  6.10     0 hiland       0      1      0       0</span>
<span class="co">#&gt; 3     1     1     3      1  7.90     0 weight       0      0      1       0</span>
<span class="co">#&gt; 4     1     1     4      0 10.8      0 yoplait      0      0      0       1</span>
<span class="co">#&gt; 5     1     2     1      1  9.80     0 dannon       1      0      0       0</span>
<span class="co">#&gt; 6     1     2     2      0  6.40     0 hiland       0      1      0       0</span>
<span class="co">#&gt; # … with 4 more variables: brand_dannon &lt;int&gt;, brand_hiland &lt;int&gt;,</span>
<span class="co">#&gt; #   brand_weight &lt;int&gt;, brand_yoplait &lt;int&gt;</span></code></pre></div>
<p>Now I can use those columns as covariates:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mnl_pref_dummies</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/logitr.html">logitr</a></span><span class="op">(</span>
  data   <span class="op">=</span> <span class="va">yogurt</span>,
  choice <span class="op">=</span> <span class="st">'choice'</span>,
  obsID  <span class="op">=</span> <span class="st">'obsID'</span>,
  pars   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="st">'price'</span>, <span class="st">'feat'</span>, <span class="st">'brand_yoplait'</span>, <span class="st">'brand_dannon'</span>, <span class="st">'brand_weight'</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>Running Model...
Done!</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mnl_pref_dummies</span><span class="op">)</span>
<span class="co">#&gt; =================================================</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; logitr(data = yogurt, choice = "choice", obsID = "obsID", pars = c("price", </span>
<span class="co">#&gt;     "feat", "brand_yoplait", "brand_dannon", "brand_weight"))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Frequencies of alternatives:</span>
<span class="co">#&gt;        1        2        3        4 </span>
<span class="co">#&gt; 0.402156 0.029436 0.229270 0.339138 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Exit Status: 3, Optimization stopped because ftol_rel or ftol_abs was reached.</span>
<span class="co">#&gt;                                 </span>
<span class="co">#&gt; Model Type:    Multinomial Logit</span>
<span class="co">#&gt; Model Space:          Preference</span>
<span class="co">#&gt; Model Run:                1 of 1</span>
<span class="co">#&gt; Iterations:                   18</span>
<span class="co">#&gt; Elapsed Time:        0h:0m:0.02s</span>
<span class="co">#&gt; Algorithm:        NLOPT_LD_LBFGS</span>
<span class="co">#&gt; Weights Used?:             FALSE</span>
<span class="co">#&gt; Robust?                    FALSE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Model Coefficients: </span>
<span class="co">#&gt;                Estimate Std. Error z-value  Pr(&gt;|z|)    </span>
<span class="co">#&gt; price         -0.366581   0.024366 -15.045 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; feat           0.491412   0.120063   4.093 4.259e-05 ***</span>
<span class="co">#&gt; brand_yoplait  4.450197   0.187118  23.783 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; brand_dannon   3.715575   0.145419  25.551 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; brand_weight   3.074399   0.145384  21.147 &lt; 2.2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt;                                      </span>
<span class="co">#&gt; Log-Likelihood:         -2656.8878788</span>
<span class="co">#&gt; Null Log-Likelihood:    -3343.7419990</span>
<span class="co">#&gt; AIC:                     5323.7757575</span>
<span class="co">#&gt; BIC:                     5352.7168000</span>
<span class="co">#&gt; McFadden R2:                0.2054148</span>
<span class="co">#&gt; Adj McFadden R2:            0.2039195</span>
<span class="co">#&gt; Number of Observations:  2412.0000000</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by John Helveston.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
